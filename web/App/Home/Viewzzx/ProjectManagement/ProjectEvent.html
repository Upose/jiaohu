<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="__DOCLAY__/plugins/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="__CSS__/ProjectEvent.css" media="all">
		<link rel="stylesheet" href="__CSS__/ProjectCollectiontitle.css" media="all">	
    <script src="__STATIC__/jquery-2.0.3.min.js"></script>
	<script src="__STATIC__/vue.min.js"></script>
</head>
<body id="app" >
    <div id="event-view">
			<div class="details_gao">
				<blockquote class="layui-elem-quote">项目里程碑</blockquote>
				<div class="layui-row layui-col-space1">
					<div class="layui-col-md2">
						<div class="grid-demo">
								<img  src="/Public/Doc/images/user.png" alt="">							
						</div>
						<div class="style-agile-border">
						<img  src="/Public/Doc/images/sty1.png" alt="">
						</div>
						<div class="layui_code">商务/售前</div>
					</div>
					<div class="layui-col-md2">
						<div class="grid-demo">
						<ul>
							<li class="layui-tab-zi">
								<a href="{:U('ProjectManagement/ProjectDisplay')}">
								  <h3 class="layui-cite">项目信息</h3>
								</a>
							</li>
							<li class="layui-tab-zi layui-tab-top">
								<a href="{:U('ProjectManagement/ProjectApproval')}">
								<h3 class="layui-cite">立项</h3>
								</a>
							</li>
							<li class="layui-tab-zi layui-tab-top">
								<a href="{:U('ProjectManagement/ProjectCollection')}">
								<h3 class="layui-cite">项目成员</h3>
								</a>
							</li>
							<li class="layui-tab-zi layui-tab-top">
								<a href="{:U('ProjectManagement/ProjectCustomer')}">
								<h3 class="layui-cite">客户关系</h3>
								</a>
							</li>
						</ul>
						</div>
						<div class="style-agile-border">
						<img  src="/Public/Doc/images/sty1.png" alt="">
						</div>
						<div class="layui_code">启动</div>
					</div>
					<div class="layui-col-md2">
						<div class="grid-demo">
							<ul>
							<li class="layui-tab-zhong">
								<a href="{:U('ProjectManagement/LCBplan')}">
								<h3 class="layui-cite">里程碑计划</h3>
								</a>
							</li>
							<li class="layui-tab-zhong layui-tab-top">
								<a href="{:U('ProjectManagement/ProjectWeekPlan')}">
								<h3 class="layui-cite">工作计划</h3>
								</a>
							</li>
						</ul>
						</div>
						<div class="style-agile-border">
						<img  src="/Public/Doc/images/sty1.png" alt="">
						</div>
						<div class="layui_code">计划管理</div>
					</div>
					<div class="layui-col-md2">
						<div class="grid-demo">
						<ul>
							<li class="layui-tab-zi">
								<a href="{:U('ProjectManagement/WeeklyControl')}">
								<h3 class="layui-cite">周报管理</h3>
								</a>
							</li>
							<li class="layui-tab-zi layui-tab-top">
								<a href="{:U('ProjectManagement/ProjectMinutes')}">
								<h3 class="layui-cite">会议管理</h3>
								</a>
							</li>
							<li class="layui-tab-zi layui-tab-top">
								<a href="{:U('ProjectManagement/Projectrisk')}">
								<h3 class="layui-cite">风险管理</h3>
								</a>
							</li>
							<li class="layui-tab-zi layui-tab-top layui-red">
								<a href="{:U('ProjectManagement/ProjectEvent')}">
								<h3 class="layui-cite">事件管理</h3>
								</a>
							</li>
						</ul>
						</div>
						<div class="style-agile-border">
						<img  src="/Public/Doc/images/sty1.png" alt="">
						</div>
						<div class="layui_code">执行管理</div>
					</div>
					<div class="layui-col-md2">
						<div class="grid-demo">
						<ul>
							<li class="layui-tab-zhonging">
								<a href="{:U('ProjectManagement/ProjectText')}">
								<h3 class="layui-cite">测试报告</h3>
								</a>
							</li>
						</ul>
						</div>
						<div class="style-agile-border">
						<img  src="/Public/Doc/images/sty1.png" alt="">
						</div>
						<div class="layui_code">测试联调</div>
					</div>
					<div class="layui-col-md2">
						<div class="grid-demo">
						<ul>
							<li class="layui-tab-zhonging">
								<a href="{:U('ProjectManagement/ProjectTextrun')}">
								<h3 class="layui-cite">试运行记录</h3>
								</a>
							</li>
						</ul>
						</div>
						<div class="style-agile-border">
						<img  src="/Public/Doc/images/sty1.png" alt="">
						</div>
						<div class="layui_code">试运行</div>
					</div>
					<div class="layui-col-md2">
						<div class="grid-demo">						
						<ul>
							<li class="layui-tab-zhongpp">
								<a href="{:U('ProjectManagement/ProjectAcceptance')}">
								<h3 class="layui-cite">项目验收</h3>
								</a>
							</li>
							<li class="layui-tab-zhongpp layui-tab-top">
								<a href="{:U('KnowledgeSharing/index')}">
								<h3 class="layui-cite">成员考勤</h3>
								</a>
							</li>
							<li class="layui-tab-zhongpp layui-tab-top">
								<a href="{:U('KnowledgeSharing/index')}">
								<h3 class="layui-cite">成员考核</h3>
								</a>
							</li>
						</ul>
						</div>
						<div class="layui_code">验收归档</div>
					</div>
				</div>
			</div>
			<div class="details_zhong">
				<div class="layui-row">
					<div class="layui-col-md12">
					<blockquote class="layui-elem-quote addThispro">事件信息列表</blockquote>
					<button class="addThisPeo" lay-filter="addThisPeo">新增事件</button>
					</div>
					<div class="layui-col-md12">
					<table class="layui-hide" id="peoples" lay-filter="peoples"></table>
					</div>
				</div>
			</div>
			</div>
		</div>
		<!-- 新增功能弹框 -->
		<div class="layui-row" id="addPeople" style="display: none;padding: 20px 30px;">
			<div class="layui-col-md12">
					<form class="layui-form" id="addEmployeeForm">
						<div class="layui-col-md6">
							<div class="layui-form-item">
									<label class="layui-form-label">所属阶段：</label>
									<div class="layui-input-block">
											<select name="add_jd" id="add_jd" lay-verify="required" lay-filter="see_depart">
													<option value="">请选择所属阶段</option>
											</select>
									</div>
							</div>
						</div>
						<div class="layui-col-md6">
							<div class="layui-form-item">
									<label class="layui-form-label">事件名称：</label>
									<div class="layui-input-block">
										<input type="text" name="event_name" class="layui-input" lay-verify="required">
									</div>
							</div>
						</div>
						<div class="layui-col-md6">
							<div class="layui-form-item">
									<label class="layui-form-label">事件类别：</label>
									<div class="layui-input-block">
											<select name="add_lb" id="add_lb" lay-verify="required" lay-filter="see_depart">
													<option value="">请选择事件类别</option>
											</select>
									</div>
							</div>
						</div>
						<div class="layui-col-md6">
							<div class="layui-form-item">
									<label class="layui-form-label">事件级别：</label>
									<div class="layui-input-block">
											<select class="layui-input" name="level"  lay-verify="required">
												<option value ="">请选择会议级别</option>
												<option value ="1">普通</option>
												<option value ="2">严重</option>
											</select>
									</div>
							</div>
						</div>
						<div class="layui-col-md6">
							<div class="layui-form-item">
									<label class="layui-form-label">发生时间：</label>
									<div class="layui-input-block">
											<input name="conpany" id="test1" class="layui-input" lay-verify="required">
									</div>
							</div>
						</div>
						<div class="layui-col-md12">
							<div class="layui-form-item">
									<label class="layui-form-label">事件内容：</label>
								<div class="layui-input-block">
									<textarea name="contentadd" placeholder="" class="layui-textarea"></textarea>
								</div>
							</div>
						</div>
						<div class="layui-col-md12">
						<div class="layui-form-item">
							<label class="layui-form-label">相关备注：</label>
							<div class="layui-input-block">
								<textarea name="textject" placeholder="" class="layui-textarea"></textarea>
							</div>
						</div>
						</div>
						<div class="layui-col-md12">
							<div class="layui-form-item">
								<label class="layui-form-label">文件上传：</label>
								<button type="button" class="layui-btn layui-btn-sm" id="upwenjian">
									<i class="layui-icon">&#xe67c;</i>添加附件
								</button>
								<button type="button" class="layui-btn layui-btn-sm" id="uploadBtn">
										<i class="layui-icon">&#xe67c;</i>上传文件
								</button>
								<span id="fileName"></span>
							</div>
						</div>
						<div class="layui-form-item">
							<div class="layui-input-block">
								<button class="layui-btn" lay-submit="" lay-filter="demoone">提交</button>
								<button type="reset" class="layui-btn layui-btn-primary">重置</button>
							</div>
						</div>	
					</form>
			</div>
	</div>
</body>
<script src="__DOCLAY__/plugins/layui/layui.js"></script>
<script type="text/html" id="barDemo">
  <a class="layui-btn layui-btn-xs" lay-event="edit">查看</a>
</script>
<script>
	$("input").attr("autocomplete","off");//解决input输入框有历史记录问题
	var  uptext;
	var form,layedit,layer,laydate; 
	layui.use(['form', 'layedit', 'laydate','table'], function(){
	  form = layui.form,
		layer = layui.layer,
		layedit = layui.layedit,
		laydate = layui.laydate;
		var table = layui.table;
	//开始日期 
		laydate.render({
			elem: '#test1'
			});

			
			form.on('submit(demoone)', function(data){	
				var s_time=$("#test1").val();  
				$.ajax({
				url:"{:U('ItemImplement/eventAdd')}",
				type: 'post',
				data: {
							pCode:"12",  //  项目id  后期添加
							stage :data.field.add_jd,
							event_name:data.field.event_name,
							event_type:data.field.add_lb,
							level :data.field.level,
							happen_time :s_time,
							event_content:data.field.contentadd,
							remarks:data.field.textject,
							founder_id :'2222',  //后期登录后添加
							filepath:uptext,
				},
				dataType: 'json',
				success: function(res) {
						if(res.code == 200) {
							layui.use('layer', function() {	
								layer.close(layer.index);
								layer.alert('添加成功');
								location.reload();
							})
						} else {
							layui.use('layer', function() {
								var layer = layui.layer;
								layer.alert('添加失败');
							})
						}			
				},
				})
				return false;
			});	
			
			table.render({
				elem: '#peoples',
				url:"{:U('ItemImplement/eventList')}",
				where:{                     //  页面传值   项目经理id
					pCode:12
				},
				// even:true,
				height: 270,
				cellMinWidth: 110,
				cols: [[
					{field:'event_name', title: '事件名称',align:'center'},
					{field:'levels',title: '事件级别',align:'center'},
					{field:'happen_time',title: '发生时间'}, //minWidth：局部定义当前单元格的最小宽度，layui 2.2.1 新增
					{field:'etype', title: '事件类别',align:'center'},
					// {field:'right',title: '操作',toolbar: '#barDemo',align:'center'}
				]],
				page: true,//开启分页
				limit:5,   //默认十条数据一页
				limits:false,  //数据分页条
			});
			projectpStaus();  // 所属阶段
		});
		
				function projectpStaus(){
					$.ajax({
					url:"{:U('ItemImplement/eventDropResult')}",
					type: 'post',
					data: {},
					dataType: 'json',
					success: function(data) {
							if (data.code == 200) {
									var result = data.data || [];
									console.log(result);
									var role = document.getElementById("add_jd");        //add_role_name给select定义的id     
									var role1 = document.getElementById("add_lb");        //add_role_name给select定义的id              	               	      
									for (var i = 0; i<result.pStaus.length; i++) {
											var option = document.createElement("option");    // 创建添加option属性
											option.setAttribute("value",result.pStaus[i].t_id);                  // 给option的value添加值
											option.innerText= result.pStaus[i].stage;             // 打印option对应的纯文本 （超级管理员、管理员）
											role.appendChild(option);                          // 给select 添加option子标签
											form.render("select");                                // 刷性select，显示出数据        
											} 
									for (var i = 0; i<result.eType.length; i++) {
											var option = document.createElement("option");    // 创建添加option属性
											option.setAttribute("value",result.eType[i].id);                  // 给option的value添加值
											option.innerText= result.eType[i].etype;             // 打印option对应的纯文本 （超级管理员、管理员）
											role1.appendChild(option);                          // 给select 添加option子标签
											form.render("select");                                // 刷性select，显示出数据        
											} 		

							}
					}    
					})
				}		
		// 文件上传
		layui.use('upload', function(){
			var upload = layui.upload;			 
			//执行实例  但不执行上传功能
			var uploadInst = upload.render({
				elem: '#upwenjian', //绑定元素
				url: "{:U('ItemAcceptance/fileUpload')}", //上传接口
				accept:'file',
				auto: false, 
				bindAction: '#uploadBtn',
				choose: function(obj) {
					obj.preview(function(index, file, result) {
						$("#fileName").html(file.name);
					});
				},
				done: function(res) {
					uptext =res.data.src;
					console.log(uptext);
					layer.msg(res.msg);
				}
			});
		});
		
		// 添加项目组成员
		$('.addThisPeo').on('click',function(){
				layer.open({
						type: 1,
						title: '新增事件管理',
						closeBtn: 2,   // 关闭样式
						shadeClose: true,  // 关闭方式
						anim:5,    // 弹出样式
						area: ['48vw', '82vh'],
						// btn:['确定','取消'],
						isOutAnim:false,    // 关闭动画
						content: $('#addPeople'),
				})
		}); 

</script>
</html>
