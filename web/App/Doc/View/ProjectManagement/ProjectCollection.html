<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="__DOCLAY__/plugins/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="__CSS__/ProjectCollection.css" media="all">
		<link rel="stylesheet" href="__CSS__/ProjectCollectiontitle.css" media="all">	
    <script src="__STATIC__/jquery-2.0.3.min.js"></script>
	<script src="__STATIC__/vue.min.js"></script>
</head>

<body id="app" >
    <div id="event-view">
			<div class="details_gao">
				<blockquote class="layui-elem-quote">项目里程碑</blockquote>
				<div class="layui-row layui-col-space1">
					<div class="layui-col-md2">
						<div class="grid-demo">
								<img  src="/Public/Doc/images/user.png" alt="">							
						</div>
						<div class="style-agile-border">
						<img  src="/Public/Doc/images/sty1.png" alt="">
						</div>
						<div class="layui_code">商务/售前</div>
					</div>
					<div class="layui-col-md2">
						<div class="grid-demo">
						<ul>
							<li class="layui-tab-zi">
								<a href="{:U('ProjectManagement/ProjectDisplay')}">
								  <h3 class="layui-cite">项目信息</h3>
								</a>
							</li>
							<li class="layui-tab-zi layui-tab-top">
								<a href="{:U('ProjectManagement/ProjectApproval')}">
								<h3 class="layui-cite">立项</h3>
								</a>
							</li>
							<li class="layui-tab-zi layui-tab-top layui-red">
								<a href="{:U('ProjectManagement/ProjectCollection')}">
								<h3 class="layui-cite">项目成员</h3>
								</a>
							</li>
							<li class="layui-tab-zi layui-tab-top">
								<a href="{:U('ProjectManagement/ProjectCustomer')}">
								<h3 class="layui-cite">客户关系</h3>
								</a>
							</li>
						</ul>
						</div>
						<div class="style-agile-border">
						<img  src="/Public/Doc/images/sty1.png" alt="">
						</div>
						<div class="layui_code">启动</div>
					</div>
					<div class="layui-col-md2">
						<div class="grid-demo">
							<ul>
							<li class="layui-tab-zhong">
								<a href="{:U('Feedback/index')}">
								<h3 class="layui-cite">里程碑计划</h3>
								</a>
							</li>
							<li class="layui-tab-zhong layui-tab-top">
								<a href="{:U('ProjectManagement/ProjectWeekPlan')}">
								<h3 class="layui-cite">工作计划</h3>
								</a>
							</li>
						</ul>
						</div>
						<div class="style-agile-border">
						<img  src="/Public/Doc/images/sty1.png" alt="">
						</div>
						<div class="layui_code">计划管理</div>
					</div>
					<div class="layui-col-md2">
						<div class="grid-demo">
						<ul>
							<li class="layui-tab-zi">
								<a href="{:U('Feedback/index')}">
								<h3 class="layui-cite">周报管理</h3>
								</a>
							</li>
							<li class="layui-tab-zi layui-tab-top">
								<a href="{:U('ProjectManagement/ProjectMinutes')}">
								<h3 class="layui-cite">会议管理</h3>
								</a>
							</li>
							<li class="layui-tab-zi layui-tab-top">
								<a href="{:U('ProjectManagement/Projectrisk')}">
								<h3 class="layui-cite">风险管理</h3>
								</a>
							</li>
							<li class="layui-tab-zi layui-tab-top">
								<a href="{:U('ProjectManagement/ProjectEvent')}">
								<h3 class="layui-cite">事件管理</h3>
								</a>
							</li>
						</ul>
						</div>
						<div class="style-agile-border">
						<img  src="/Public/Doc/images/sty1.png" alt="">
						</div>
						<div class="layui_code">执行管理</div>
					</div>
					<div class="layui-col-md2">
						<div class="grid-demo">
						<ul>
							<li class="layui-tab-zhonging">
								<a href="{:U('ProjectManagement/ProjectText')}">
								<h3 class="layui-cite">测试报告</h3>
								</a>
							</li>
						</ul>
						</div>
						<div class="style-agile-border">
						<img  src="/Public/Doc/images/sty1.png" alt="">
						</div>
						<div class="layui_code">测试联调</div>
					</div>
					<div class="layui-col-md2">
						<div class="grid-demo">
						<ul>
							<li class="layui-tab-zhonging">
								<a href="{:U('ProjectManagement/ProjectTextrun')}">
								<h3 class="layui-cite">试运行记录</h3>
								</a>
							</li>
						</ul>
						</div>
						<div class="style-agile-border">
						<img  src="/Public/Doc/images/sty1.png" alt="">
						</div>
						<div class="layui_code">试运行</div>
					</div>
					<div class="layui-col-md2">
						<div class="grid-demo">						<ul>
							<li class="layui-tab-zhongpp ">
								<a href="{:U('ProjectManagement/ProjectAcceptance')}">
								<h3 class="layui-cite">项目验收</h3>
								</a>
							</li>
							<li class="layui-tab-zhongpp layui-tab-top">
								<a href="{:U('KnowledgeSharing/index')}">
								<h3 class="layui-cite">成员考勤</h3>
								</a>
							</li>
							<li class="layui-tab-zhongpp layui-tab-top">
								<a href="{:U('KnowledgeSharing/index')}">
								<h3 class="layui-cite">成员考核</h3>
								</a>
							</li>
						</ul>
						</div>
						<div class="layui_code">验收归档</div>
					</div>
				</div>
			</div>
			<div class="details_zhong">
				<div class="layui-row">
					<div class="layui-col-md12">
					<blockquote class="layui-elem-quote addThispro">成员信息列表</blockquote>
					<button class="addThisPeo" lay-filter="addThisPeo">新建成员</button>
					</div>
					<div class="layui-col-md12">
					<table class="layui-hide" id="peoples" lay-filter="peoples"></table>
					</div>
				</div>

		</div>
				
			<div class="details_di">
				<blockquote class="layui-elem-quote">历史信息</blockquote>
				<div class="caller-contar"> 
					<div class="caller-item">
						<img src="/Public/Doc/images/portrait.png" alt="" class="caller-img caller-fl">
						 <div class="caller-main caller-fl">       
							<p><strong>胡歌</strong></p>
							<p class="caller-adds">长宁分局-科长</p>
							<div class="caller-iconset">
						</div>
					</div>
				</div>
			</div>	
	</div>
	<!-- 新增功能弹框 -->
	<div class="layui-row" id="addPeople" style="display: none;padding: 20px 30px;">
		<div class="layui-col-md10">
				<form class="layui-form" id="addEmployeeForm">
						<div class="layui-form-item">
								<label class="layui-form-label">所在部门：</label>
								<div class="layui-input-block">
										<select name="add_department" lay-verify="required" id="add_department" lay-filter="see_depart">
												<option value="">请选择部门</option>
										</select>
								</div>
						</div>
						<div class="layui-form-item">
								<label class="layui-form-label">组员姓名：</label>
								<div class="layui-input-block">
										<select name="add_peo" lay-verify="required" id="add_peo">
												<option value="">请选择组员姓名</option>
										</select>
								</div>
						</div>
						<div class="layui-form-item">
								<label class="layui-form-label">所属岗位：</label>
								<div class="layui-input-block">
										<select class="layui-input" name="add_job" id="add_job" lay-verify="required">
											<option value ="">请选择岗位职责</option>

										</select>
								</div>
						</div>
						<div class="layui-form-item">
								<label class="layui-form-label">到岗时间：</label>
								<div class="layui-input-block">
										  <input type="text" class="layui-input" id="test1" placeholder="yyyy年MM月dd日" lay-verify="required">
								</div>
						</div>
						<div class="layui-form-item">
								<label class="layui-form-label">离岗时间：</label>
								<div class="layui-input-block">
										 <input type="text" class="layui-input" id="test2" placeholder="yyyy年MM月dd日">
								</div>
						</div>
						<div class="layui-form-item">
								<label class="layui-form-label">人员类型：</label>
								<div class="layui-input-block">
									<select class="layui-input" name="deptId" id="deptSelect" lay-verify="required">
										<option value ="">请选择人员类型</option>
										<option value ="0">计划内</option>
										<option value ="1">新增</option>
										<option value ="2">离场</option>
									</select>
								</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">人员备注：</label>
							<div class="layui-input-block">
								<textarea name="textject" placeholder="" class="layui-textarea"></textarea>
							</div>
						</div>
						<div class="layui-form-item">
							<div class="layui-input-block">
								<button class="layui-btn" lay-submit="" lay-filter="demoone">提交</button>
								<button type="reset" class="layui-btn layui-btn-primary">重置</button>
							</div>
						</div>	
				</form>
		</div>
</div>
	
</body>
<script src="__DOCLAY__/plugins/layui/layui.js"></script>
<script type="text/html" id="barDemo">
  <a class="layui-btn layui-btn-xs btn-xiao" lay-event="edit">查看</a>
</script>
<script>
	var form,layedit,layer,laydate; 
	layui.use(['form', 'layedit', 'laydate','table'], function(){
	  form = layui.form,
	  layer = layui.layer,
	  layedit = layui.layedit,
	  laydate = layui.laydate;
		var table = layui.table;

	//到岗日期 
		laydate.render({
			elem: '#test1'
			});
	//离岗日期 
		laydate.render({
			elem: '#test2'
			});
	//  根据部门选取成员		
		form.on('select(see_depart)', function(data){
			var peo_name =$("#add_department").val(); 
			$.ajax({
			url:"{:U('ItemStartUp/memberDropResult')}",
			type: 'post',
			data: {
				deptCode :peo_name
			},
			dataType: 'json',
			success: function(data) {
					if (data.code == 200) {
							var result = data || [];
							var role_peo = document.getElementById("add_peo");        //add_role_name给select定义的id  	      	      
							for (var i = 0; i<result.data.length; i++) {
									var option = document.createElement("option");    // 创建添加option属性
									option.setAttribute("value",result.data[i].mid);                  // 给option的value添加值
									option.innerText= result.data[i].member_name;             // 打印option对应的纯文本 （超级管理员、管理员）
									role_peo.appendChild(option);                          // 给select 添加option子标签
									form.render("select");                                // 刷性select，显示出数据        
									}
					}
			}    
			})				
			});
				//监听提交
			form.on('submit(demoone)', function(data){
				console.log(data);
				var jectname =$("#add_peo").find("option:selected").text(); 
				var s_time=$("#test1").val(); 				
				var e_time =$("#test2").val(); 
				$.ajax({
				url:"{:U('ItemStartUp/proPersionAdd')}",
				type: 'post',
				data: {
					uCode:data.field.add_peo,
					mName :jectname,
					pCode:'11',  // 项目编号  后期有前面页面传值
					duty :data.field.add_job,
					dept :data.field.add_department,
					cTime :s_time,
					lTime :e_time,
					oType:data.field.deptId,
					remarks:data.field.textject,
					founder_id:'240' //后期由登录传值 
				},
				dataType: 'json',
				success: function(res) {
						if(res.code == 200) {
							layui.use('layer', function() {								
              layer.close(layer.index);
								layer.alert('提交成功');
							})
						} else {
							layui.use('layer', function() {
								var layer = layui.layer;
								layer.alert('添加失败');
							})
						}			
				},
				})
				return false;
			});
			
			table.render({
				elem: '#peoples',
				url:"{:U('ItemStartUp/persionList')}",
				where:{                     //  页面传值   项目经理id
					pCode:12
				},
				height:310,
				cellMinWidth: 130,
				// totalRow: true,
				cols: [[
				{field:'id', title: 'ID',sort: true,align:'center'},
				{field:'member_name', title: '组员姓名',align:'center'},
				{field:'dept', title: '部门',align:'center'},
				{field:'operation_type',title: '人员类型',align:'center'},
				{field:'come_time',title: '入场时间',align:'center'},
				{field:'leave_time', title: '离职时间',align:'center'},
				{field:'create_data', title: '创建时间',align:'center'},
				{field:'right', title: '操作',toolbar: '#barDemo',align:'center'}
				]],
				page:true,
				limit:6,   //默认6条数据一页
				limits:false,  //数据分页条
			});
			selectDepart();   //  选择项目组成员部门
		});

		// 添加项目组成员
		$('.addThisPeo').on('click',function(){
				layer.open({
						type: 1,
						title: '新增项目成员',
						closeBtn: 2,   // 关闭样式
						shadeClose: true,  // 关闭方式
						anim:5,    // 弹出样式
						area: ['36vw', '78vh'],
						// btn:['确定','取消'],
						isOutAnim:false,    // 关闭动画
						content: $('#addPeople'),
				})								
		}); 
		
		
		
		function selectDepart(){
			$.ajax({
			url:"{:U('ItemStartUp/deptmentDropResult')}",
			type: 'post',
			data: {},
			dataType: 'json',
			success: function(data) {
					if (data.code == 200) {
							var result = data.data || [];
							console.log(result);
							var role = document.getElementById("add_department");        //add_role_name给select定义的id  
							var role_job = document.getElementById("add_job");     	      	      
							for (var i = 0; i<result.dResult.length; i++) {
									var option = document.createElement("option");    // 创建添加option属性
									option.setAttribute("value",result.dResult[i].did);                  // 给option的value添加值
									option.innerText= result.dResult[i].deptname;             // 打印option对应的纯文本 （超级管理员、管理员）
									role.appendChild(option);                          // 给select 添加option子标签
									form.render("select");                                // 刷性select，显示出数据        
									} 
							for (var i = 0; i<result.jResult.length; i++) {
									var option = document.createElement("option");    // 创建添加option属性
									option.setAttribute("value",result.jResult[i].jid);                  // 给option的value添加值
									option.innerText= result.jResult[i].jobtype_name;             // 打印option对应的纯文本 （超级管理员、管理员）
									role_job.appendChild(option);                          // 给select 添加option子标签
									form.render("select");                                // 刷性select，显示出数据        
									} 
					}
			}    
			})
		}	
		
		
</script>
</html>