<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="__DOCLAY__/plugins/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="__CSS__/ProjectCustomer.css" media="all">
		<link rel="stylesheet" href="__CSS__/ProjectCollectiontitle.css" media="all">	
    <script src="__STATIC__/jquery-2.0.3.min.js"></script>
	<script src="__STATIC__/vue.min.js"></script>
</head>

<body id="app" >
    <div id="event-view">
			<div class="details_gao">
				<blockquote class="layui-elem-quote">项目里程碑</blockquote>
				<div class="layui-col-lg2">
					<div class="layui-line-me">	
						<div class="style-agile">
							<img  src="/Public/Doc/images/user.png" alt="">
						</div>
					</div>
					<div class="layui_code">商务/售前</div>
				</div>
				<div class="layui-col-lg2 layui_left_title">
					<div class="layui-line-me">
						<ul>
							<li class="layui-tab-zi">
								<a href="{:U('ProjectManagement/ProjectDisplay')}">
								  <h3 class="layui-cite">项目基本信息</h3>
								</a>
							</li>
							<li class="layui-tab-zi layui-tab-top">
								<a href="{:U('ProjectManagement/ProjectApproval')}">
								<h3 class="layui-cite">立项</h3>
								</a>
							</li>
							<li class="layui-tab-zi layui-tab-top">
								<a href="{:U('ProjectManagement/ProjectCollection')}">
								<h3 class="layui-cite">项目成员</h3>
								</a>
							</li>
							<li class="layui-tab-zi layui-tab-top layui-red">
								<a href="{:U('ProjectManagement/ProjectCustomer')}">
								<h3 class="layui-cite">客户关系</h3>
								</a>
							</li>
						</ul>						
					</div>				
					<div class="layui_code">启动</div>
					<div class="style-agile-border">
						<img  src="/Public/Doc/images/sty1.png" alt="">
					</div>
				</div>

				<div class="layui-col-lg2 layui_left_title">
					<div class="layui-line-me">
						<ul>
							<li class="layui-tab-zhong">
								<a href="{:U('Feedback/index')}">
								<h3 class="layui-cite">里程碑计划</h3>
								</a>
							</li>
							<li class="layui-tab-zhong layui-tab-top">
								<a href="{:U('KnowledgeSharing/index')}">
								<h3 class="layui-cite">工作计划</h3>
								</a>
							</li>
						</ul>
					</div>
					<div class="layui_code">计划管理</div>
					<div class="style-agile-border">
						<img  src="/Public/Doc/images/sty1.png" alt="">
					</div>
				</div>
				<div class="layui-col-lg2 layui_left_title">
					<div class="layui-line-me">
						<ul>
							<li class="layui-tab-zi">
								<a href="{:U('Feedback/index')}">
								<h3 class="layui-cite">周报管理</h3>
								</a>
							</li>
							<li class="layui-tab-zi layui-tab-top">
								<a href="{:U('ProjectManagement/ProjectMinutes')}">
								<h3 class="layui-cite">会议管理</h3>
								</a>
							</li>
							<li class="layui-tab-zi layui-tab-top">
								<a href="{:U('ProjectManagement/Projectrisk')}">
								<h3 class="layui-cite">风险管理</h3>
								</a>
							</li>
							<li class="layui-tab-zi layui-tab-top">
								<a href="{:U('ProjectManagement/ProjectEvent')}">
								<h3 class="layui-cite">事件管理</h3>
								</a>
							</li>
						</ul>
					</div>	
					<div class="layui_code">执行管理</div>
					<div class="style-agile-border">
						<img  src="/Public/Doc/images/sty1.png" alt="">
					</div>
				</div>
				<div class="layui-col-lg2 layui_left_title">
					<div class="layui-line-me">
						<ul>
							<li class="layui-tab-zhonging">
								<a href="{:U('Feedback/index')}">
								<h3 class="layui-cite">测试报告</h3>
								</a>
							</li>
						</ul>
					</div>
					<div class="layui_code">测试联调</div>
					<div class="style-agile-border">
						<img  src="/Public/Doc/images/sty1.png" alt="">
					</div>
				</div>
				<div class="layui-col-lg2 layui_left_title">
					<div class="layui-line-me">
						<ul>
							<li class="layui-tab-zhonging">
								<a href="{:U('ProjectManagement/ProjectTextrun')}">
								<h3 class="layui-cite">试运行记录</h3>
								</a>
							</li>
						</ul>
					</div>	
					<div class="layui_code">试运行</div>	
						<div class="style-agile-border">
							<img  src="/Public/Doc/images/sty1.png" alt="">
						</div>
				</div>
				<div class="layui-col-lg2 layui_left_title">
					<div class="layui-line-me">
						<ul>
							<li class="layui-tab-zhongpp">
								<a href="{:U('ProjectManagement/ProjectAcceptance')}">
								<h3 class="layui-cite">项目验收</h3>
								</a>
							</li>
							<li class="layui-tab-zhongpp layui-tab-top">
								<a href="{:U('KnowledgeSharing/index')}">
								<h3 class="layui-cite">成员考勤</h3>
								</a>
							</li>
							<li class="layui-tab-zhongpp layui-tab-top">
								<a href="{:U('KnowledgeSharing/index')}">
								<h3 class="layui-cite">成员考核</h3>
								</a>
							</li>
						</ul>
					</div>
					<div class="layui_code">验收归档</div>
					<div class="style-agile-border">
						<img  src="/Public/Doc/images/sty1.png" alt="">
					</div>
				</div>

			</div>
			<div class="details_zhong">
				<div>
				<blockquote class="layui-elem-quote addThispro">项目信息采集</blockquote>
				<button class="addThisPeo" id="btnzeng">新建组员</button>
				</div>
				<table class="layui-table">
						<thead>
								<tr>
										<th>所在单位</th>
										<th>所属职责</th>
										<th>客户类型</th>
										<th>客户姓名</th>
										<th>离岗时间</th>
										<th>联系电话</th>
										<th>人员邮箱</th>
										<th>人员备注</th>
										<th>操作</th>
								</tr>
						</thead>
						<tbody>
								<tr v-for="item in arrList">
										<td>{{item.theme}}</td>
										<td>{{item.address}}</td>
										<td>{{item.meeting_time}}</td>
										<td>{{item.meeting_level}}</td>
										<td>{{item.department_id}}</td>
										<td>{{item.department_id}}</td>
										<td>2</td>
										<td>1</td>
										<td style="cursor:pointer;" @click="openNew(item.id)">
											<a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
											<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
										</td>
								</tr>
						</tbody>
				</table>
			</div>
				
			<div class="details_di">
				<blockquote class="layui-elem-quote">历史信息</blockquote>
				<div class="caller-contar"> 
					<div class="caller-item">
						<img src="/Public/Doc/images/portrait.png" alt="" class="caller-img caller-fl">
						 <div class="caller-main caller-fl">       
							<p><strong>胡歌</strong></p>
							<p class="caller-adds">长宁分局-科长</p>
							<div class="caller-iconset">
						</div>
					</div>
				</div>
				<div class="caller-contar"> 
					<div class="caller-item">
						<img src="/Public/Doc/images/portrait.png" alt="" class="caller-img caller-fl">
						<div class="caller-main caller-fl">       
							<p><strong>胡歌</strong></p>
							<p class="caller-adds">长宁分局-科长</p>
							<div class="caller-iconset">
						</div>
					</div>
				</div>
			</div>	
	</div>
	<!-- 新增功能弹框 -->
	<div class="new_div">
		<div class="new_tit"><span>新增项目成员</span><img @click='down()' src="__IMG__/close_normal.png"></div>
			<div class="con_txt">
				<p>项目名称：<select name="interest" lay-filter="aihao"  class="client_input" id="dpeopleid" v-model="addList.selectedpeople">
						<option value="">请选择</option>
						<option v-for='i in peoplemore'  :value="i.member_id">{{i.member_name}}</option>
					</select>
				</p>
				<p>所在单位：<input class="name_input" type="text" name="kname" placeholder="请输入信息"></p>
				<p>所属职责：<select name="customer_type_id" class="client_input"  v-model="addList.peo_job">
						<option value="">请选择</option>
						<option v-for='i in zpostName' :value="i.jobtype_id">{{i.jobtype_name}}</option>
					</select>
				</p>
				<p>客户类型：<select name="customer_type_id" class="client_input"  v-model="addList.peo_job">
						<option value="">请选择</option>
						<option v-for='i in zpostName' :value="i.jobtype_id">{{i.jobtype_name}}</option>
					</select>
				</p>
				<p>客户姓名：<input name="start_time" class="time_input" type="date" id="" v-model="addList.dao_data"></p>
				<p>联系电话：<input name="start_time" class="time_input" type="date" id="" v-model="addList.dao_data"></p>
				<p>人员邮箱：<select name="customer_type_id" class="client_input"  v-model="addList.peo_job">
						<option value="">请选择</option>
						<option v-for='i in zpostName' :value="i.jobtype_id">{{i.jobtype_name}}</option>
					</select>
				</p>
				<p>人员备注：<input class="name_input" type="text" name="kname" placeholder="请输入信息"></p>

			</div>
			<div class="btn_div"><button type="submit" @click='zeng()'>确定</button></div>
	</div>
	
</body>
<script src="__DOCLAY__/plugins/layui/layui.js"></script>
<script>
	layui.use(['form', 'layedit', 'laydate'], function(){
		var form = layui.form,
		layer = layui.layer,
		layedit = layui.layedit,
		laydate = layui.laydate;
	//日期 
		laydate.render({
			elem: '#date',
			});
		});
			 // 选择全国
		    var app = new Vue({
		        el: "app",
						data: function() {
							return {
								area:[],
								backFrame:[],
								projectmen: [],
								databaseFrame:[],
								zdepartment:[],
								zpostName:[],
								uiFrame:[],
								jsFrame:[],
								
								peoplemore:[],
								peoplelist:[],
								addList: {
									proname: '',
									proArea:'',
									uiFrame:'',
									jsFrame:'',
									backFrame:'',
									databaseFrame:'',
									stakeHolder:'',
									whether_ys:'',
									ys_date:'',
									persionRelease:'',
									departname: '',
									selectedpeople: '',
									peo_job: '',
									dao_data:''
								},
							}
						},
				created: function () {
					this.getdata();
					this.project();
					this.projectzeng();
				},
		        methods: {
							getdata() {
									var that = this;
									$.ajax({
											cache: false,
											type: "post",
											url: "{:U('ProjectDelivery/projectList')}",
											dataType: "json",
											success: function (data) {
													that.rank = data.data.rank;
											}
									})
							},
								
		            project() {
		                var that = this;
		                $.ajax({
		                    type: "post",
		                    url: "{:U('ProjectDelivery/proDelivery')}",
		                    dataType: "json",
												data:{
													projectManagerId:875
												},
		                    success: function (data) {
														that.area = data.data.area;
														that.backFrame = data.data.backFrame;
														that.uiFrame = data.data.uiFrame;
														that.jsFrame = data.data.jsFrame;
														that.databaseFrame = data.data.databaseFrame;
														that.projectmen = data.data.projectList;
		                    }
		                })
								},
								projectzeng() {
										var that = this;
										$.ajax({
												type: "post",
												url: "{:U('ProjectDelivery/addPersionDropOperation')}",
												dataType: "json",
												success: function (data) {
													that.zdepartment = data.data.department;
													that.zpostName = data.data.postName;
		
												}
										})
								},
								depart_select(){
		                var that = this;
		                $.ajax({
		                    type: "post",
		                    url: "{:U('ProjectDelivery/departmentPersion')}",
		                    dataType: "json",
												data:{
													departmentName:this.addList.departname
												},
		                    success: function (data) {
													that.peoplemore = data.data;
		
		                    }
		                })
								},
								down() {
									$(".new_div").hide();
								},
								
								// 增加新的内部人员
								zeng() {
									var that = this;
									var dproId =$("#dpropeopleid").find("option:selected").text();
									var dpersionId= $('#dpeopleid').find("option:selected").text();;
									console.log(dproId);
									console.log(dpersionId);
									$.ajax({
											type: "post",
											url: "{:U('ProjectDelivery/proDeliveryPersionAdd')}",
											dataType: "json",
											data:{
												proId:this.addList.proname,
												proName:dproId,
												persionId:this.addList.selectedpeople,
												persionName:dpersionId,
												jobType:this.addList.peo_job,
												inTime:this.addList.dao_data
											},
											success: function (data) {
												that.laypeople();
											}
									})
									
									$(".new_div").hide();
								},
								//  查询增添新的人员
								laypeople(){
										var that = this;
										$.ajax({
												type: "post",
												url: "{:U('ProjectDelivery/projectPersion')}",
												dataType: "json",
												data:{
													projectId:this.addList.proname
												},
												success: function (data) {
													that.peoplelist = data.data;
												}
										})
								},
								
								 // 交付信息提交
								submitForm(){
										var that = this;
										var dproname =$("#dpropeopleid").find("option:selected").text();
										$.ajax({
												type: "post",
												url: "{:U('ProjectDelivery/proDeliveryAdd')}",
												dataType: "json",
												data:{
													proId:this.addList.proname,
													proName:dproname,
													proArea:this.addList.proArea,
													uiFrame:this.addList.uiFrame,
													jsFrame:this.addList.jsFrame,
													backFrame:this.addList.backFrame,
													databaseFrame:this.addList.databaseFrame,
													stakeHolder:this.addList.stakeHolder,
													whether_ys:this.addList.whether_ys,
													ys_date:this.addList.ys_date,
													persionRelease:this.addList.persionRelease
													
												},
												success: function (data) {
													if(data.code == 200) {
														layui.use('layer', function() {
															layer.alert('提交成功');
														})
													} else {
														layui.use('layer', function() {
															var layer = layui.layer;
															layer.alert('添加失败');
														})
													}
												}
										})
								},
								
		        }
		    })
				
				$("#btnzeng").on('click', function () {
					$(".new_div").show();
				});
</script>
</html>