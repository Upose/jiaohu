<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="__DOCLAY__/plugins/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="__CSS__/Projectrisk.css" media="all">
		<link rel="stylesheet" href="__CSS__/ProjectCollectiontitle.css" media="all">	
    <script src="__STATIC__/jquery-2.0.3.min.js"></script>
	<script src="__STATIC__/vue.min.js"></script>
</head>

<body id="app" >
    <div id="event-view">
			<div class="details_gao">
				<blockquote class="layui-elem-quote">项目里程碑</blockquote>
				<div class="layui-row layui-col-space1">
					<div class="layui-col-md2">
						<div class="grid-demo">
								<img  src="/Public/Doc/images/user.png" alt="">							
						</div>
						<div class="style-agile-border">
						<img  src="/Public/Doc/images/sty1.png" alt="">
						</div>
						<div class="layui_code">商务/售前</div>
					</div>
					<div class="layui-col-md2">
						<div class="grid-demo">
						<ul>
							<li class="layui-tab-zi">
								<a href="{:U('ProjectManagement/ProjectDisplay')}">
								  <h3 class="layui-cite">项目信息</h3>
								</a>
							</li>
							<li class="layui-tab-zi layui-tab-top">
								<a href="{:U('ProjectManagement/ProjectApproval')}">
								<h3 class="layui-cite">立项</h3>
								</a>
							</li>
							<li class="layui-tab-zi layui-tab-top">
								<a href="{:U('ProjectManagement/ProjectCollection')}">
								<h3 class="layui-cite">项目成员</h3>
								</a>
							</li>
							<li class="layui-tab-zi layui-tab-top">
								<a href="{:U('ProjectManagement/ProjectCustomer')}">
								<h3 class="layui-cite">客户关系</h3>
								</a>
							</li>
						</ul>
						</div>
						<div class="style-agile-border">
						<img  src="/Public/Doc/images/sty1.png" alt="">
						</div>
						<div class="layui_code">启动</div>
					</div>
					<div class="layui-col-md2">
						<div class="grid-demo">
							<ul>
							<li class="layui-tab-zhong">
								<a href="{:U('Feedback/index')}">
								<h3 class="layui-cite">里程碑计划</h3>
								</a>
							</li>
							<li class="layui-tab-zhong layui-tab-top">
								<a href="{:U('KnowledgeSharing/index')}">
								<h3 class="layui-cite">工作计划</h3>
								</a>
							</li>
						</ul>
						</div>
						<div class="style-agile-border">
						<img  src="/Public/Doc/images/sty1.png" alt="">
						</div>
						<div class="layui_code">计划管理</div>
					</div>
					<div class="layui-col-md2">
						<div class="grid-demo">
						<ul>
							<li class="layui-tab-zi">
								<a href="{:U('Feedback/index')}">
								<h3 class="layui-cite">周报管理</h3>
								</a>
							</li>
							<li class="layui-tab-zi layui-tab-top">
								<a href="{:U('ProjectManagement/ProjectMinutes')}">
								<h3 class="layui-cite">会议管理</h3>
								</a>
							</li>
							<li class="layui-tab-zi layui-tab-top layui-red">
								<a href="{:U('ProjectManagement/Projectrisk')}">
								<h3 class="layui-cite">风险管理</h3>
								</a>
							</li>
							<li class="layui-tab-zi layui-tab-top">
								<a href="{:U('ProjectManagement/ProjectEvent')}">
								<h3 class="layui-cite">事件管理</h3>
								</a>
							</li>
						</ul>
						</div>
						<div class="style-agile-border">
						<img  src="/Public/Doc/images/sty1.png" alt="">
						</div>
						<div class="layui_code">执行管理</div>
					</div>
					<div class="layui-col-md2">
						<div class="grid-demo">
						<ul>
							<li class="layui-tab-zhonging">
								<a href="{:U('Feedback/index')}">
								<h3 class="layui-cite">测试报告</h3>
								</a>
							</li>
						</ul>
						</div>
						<div class="style-agile-border">
						<img  src="/Public/Doc/images/sty1.png" alt="">
						</div>
						<div class="layui_code">测试联调</div>
					</div>
					<div class="layui-col-md2">
						<div class="grid-demo">
						<ul>
							<li class="layui-tab-zhonging">
								<a href="{:U('ProjectManagement/ProjectTextrun')}">
								<h3 class="layui-cite">试运行记录</h3>
								</a>
							</li>
						</ul>
						</div>
						<div class="style-agile-border">
						<img  src="/Public/Doc/images/sty1.png" alt="">
						</div>
						<div class="layui_code">试运行</div>
					</div>
					<div class="layui-col-md2">
						<div class="grid-demo">						
						<ul>
							<li class="layui-tab-zhongpp">
								<a href="{:U('ProjectManagement/ProjectAcceptance')}">
								<h3 class="layui-cite">项目验收</h3>
								</a>
							</li>
							<li class="layui-tab-zhongpp layui-tab-top">
								<a href="{:U('KnowledgeSharing/index')}">
								<h3 class="layui-cite">成员考勤</h3>
								</a>
							</li>
							<li class="layui-tab-zhongpp layui-tab-top">
								<a href="{:U('KnowledgeSharing/index')}">
								<h3 class="layui-cite">成员考核</h3>
								</a>
							</li>
						</ul>
						</div>
						<div class="layui_code">验收归档</div>
					</div>
				</div>
			</div>
			<div class="details_zhong">
				<div class="layui-row">
					<div class="layui-col-md12">
					<blockquote class="layui-elem-quote addThispro">风险信息列表</blockquote>
					<button class="addThisPeo" lay-filter="addThisPeo">新增风险</button>
					</div>
					<div class="layui-col-md12">
					<table class="layui-hide" id="peoples" lay-filter="peoples"></table>
					</div>
				</div>
			</div>
	</div>
		<!-- 新增功能弹框 -->
		<div class="layui-row" id="addPeople" style="display: none;padding: 20px 30px;">
			<div class="layui-col-md10">
					<form class="layui-form" id="addEmployeeForm">
							<div class="layui-form-item">
									<label class="layui-form-label">所属阶段：</label>
									<div class="layui-input-block">
											<select name="add_departjd" lay-verify="required" id="add_departjd" lay-filter="see_depart">
													<option value="">请选择风险阶段</option>
											</select>
									</div>
							</div>
							<div class="layui-form-item">
									<label class="layui-form-label">风险类别：</label>
									<div class="layui-input-block">
											<select name="add_departlb" lay-verify="required" id="add_departlb" lay-filter="see_depart">
													<option value="">请选择风险类别</option>
											</select>
									</div>
							</div>
							<div class="layui-form-item">
									<label class="layui-form-label">风险等级：</label>
									<div class="layui-input-block">
											<select name="add_departdj" lay-verify="required" id="add_departdj" lay-filter="see_depart">
													<option value="">请选择风险等级</option>
													<option value="1">一级</option>
													<option value="2">二级</option>
													<option value="3">三级</option>
													
											</select>
									</div>
							</div>
							<div class="layui-form-item">
									<label class="layui-form-label">风险内容：</label>
									<div class="layui-input-block">
											<input type="text" name="add_departnr" class="layui-input" lay-verify="required">
									</div>
							</div>
							<div class="layui-form-item">
								<label class="layui-form-label">风险结果：</label>
								<div class="layui-input-block">
									<textarea name="textject" placeholder="" class="layui-textarea"></textarea>
								</div>
							</div>
							<div class="layui-form-item">
								<div class="layui-input-block">
									<button class="layui-btn" lay-submit="" lay-filter="demoone">提交</button>
									<button type="reset" class="layui-btn layui-btn-primary">重置</button>
								</div>
							</div>	
					</form>
			</div>
	</div>
	
</body>
<script src="__DOCLAY__/plugins/layui/layui.js"></script>
<script>
	var form,layedit,layer,laydate; 
	layui.use(['form', 'layedit', 'laydate','table'], function(){
		form = layui.form,
		layer = layui.layer,
		layedit = layui.layedit,
		laydate = layui.laydate;
	//开始运行日期 
		laydate.render({
			elem: '#test1'
			});
	//结束时间
		laydate.render({
			elem: '#test2'
			});
			
			fenxiandata();
				//监听提交
			form.on('submit(demoone)', function(data){
				$.ajax({
				url:"{:U('ItemImplement/riskAdd')}",
				type: 'post',
				data: {
					pCode:'11',  // 项目编号  后期有前面页面传值
					stage  :data.field.add_departjd,
					rContent  :data.field.add_departnr,
					rType  :data.field.add_departlb,
					level  :data.field.add_departdj,
					consequence :data.field.textject,
					founder_id:'240' //后期由登录传值 
				},
				dataType: 'json',
				success: function(res) {
						if(res.code == 200) {
							layui.use('layer', function() {								
							layer.close(layer.index);
								layer.alert('提交成功');
							})
						} else {
							layui.use('layer', function() {
								var layer = layui.layer;
								layer.alert('添加失败');
							})
						}			
				},
				})
				return false;
			});
			
		});
		// 添加项目组成员
		$('.addThisPeo').on('click',function(){
				layer.open({
						type: 1,
						title: '新增风险内容',
						closeBtn: 2,   // 关闭样式
						shadeClose: true,  // 关闭方式
						anim:5,    // 弹出样式
						area: ['36vw', '63vh'],
						// btn:['确定','取消'],
						isOutAnim:false,    // 关闭动画
						content: $('#addPeople'),
				})
		}); 
				
		function fenxiandata(){
			$.ajax({
			url:"{:U('ItemImplement/riskDropResult')}",
			type: 'post',
			data: {},
			dataType: 'json',
			success: function(data) {
					if (data.code == 200) {
							var result = data.data || [];
							console.log(result);
							var role = document.getElementById("add_departjd");        //add_role_name给select定义的id  
							var role_job = document.getElementById("add_departlb");     	      	      
							for (var i = 0; i<result.pStaus.length; i++) {
									var option = document.createElement("option");    // 创建添加option属性
									option.setAttribute("value",result.pStaus[i].t_id);                  // 给option的value添加值
									option.innerText= result.pStaus[i].stage;             // 打印option对应的纯文本 （超级管理员、管理员）
									role.appendChild(option);                          // 给select 添加option子标签
									form.render("select");                                // 刷性select，显示出数据        
									} 
							for (var i = 0; i<result.rType.length; i++) {
									var option = document.createElement("option");    // 创建添加option属性
									option.setAttribute("value",result.rType[i].id);                  // 给option的value添加值
									option.innerText= result.rType[i].rtype;             // 打印option对应的纯文本 （超级管理员、管理员）
									role_job.appendChild(option);                          // 给select 添加option子标签
									form.render("select");                                // 刷性select，显示出数据        
									} 
					}
			}    
			})
		}	
		
				
</script>
</html>