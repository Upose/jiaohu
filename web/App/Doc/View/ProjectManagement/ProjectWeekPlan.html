<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="__DOCLAY__/plugins/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="__CSS__/ProjectWeekPlan.css" media="all">
		<link rel="stylesheet" href="__CSS__/ProjectCollectiontitle.css" media="all">	
    <script src="__STATIC__/jquery-2.0.3.min.js"></script>
	<script src="__STATIC__/vue.min.js"></script>
</head>

<body id="app" >
    <div id="event-view">
			<div class="details_gao">
				<blockquote class="layui-elem-quote">项目里程碑</blockquote>
				<div class="layui-row layui-col-space1">
					<div class="layui-col-md2">
						<div class="grid-demo">
								<img  src="/Public/Doc/images/user.png" alt="">							
						</div>
						<div class="style-agile-border">
						<img  src="/Public/Doc/images/sty1.png" alt="">
						</div>
						<div class="layui_code">商务/售前</div>
					</div>
					<div class="layui-col-md2">
						<div class="grid-demo">
						<ul>
							<li class="layui-tab-zi">
								<a href="{:U('ProjectManagement/ProjectDisplay')}">
								  <h3 class="layui-cite">项目信息</h3>
								</a>
							</li>
							<li class="layui-tab-zi layui-tab-top">
								<a href="{:U('ProjectManagement/ProjectApproval')}">
								<h3 class="layui-cite">立项</h3>
								</a>
							</li>
							<li class="layui-tab-zi layui-tab-top">
								<a href="{:U('ProjectManagement/ProjectCollection')}">
								<h3 class="layui-cite">项目成员</h3>
								</a>
							</li>
							<li class="layui-tab-zi layui-tab-top">
								<a href="{:U('ProjectManagement/ProjectCustomer')}">
								<h3 class="layui-cite">客户关系</h3>
								</a>
							</li>
						</ul>
						</div>
						<div class="style-agile-border">
						<img  src="/Public/Doc/images/sty1.png" alt="">
						</div>
						<div class="layui_code">启动</div>
					</div>
					<div class="layui-col-md2">
						<div class="grid-demo">
							<ul>
							<li class="layui-tab-zhong">
								<a href="{:U('Feedback/index')}">
								<h3 class="layui-cite">里程碑计划</h3>
								</a>
							</li>
							<li class="layui-tab-zhong layui-tab-top layui-red">
								<a href="{:U('ProjectManagement/ProjectWeekPlan')}">
								<h3 class="layui-cite">工作计划</h3>
								</a>
							</li>
						</ul>
						</div>
						<div class="style-agile-border">
						<img  src="/Public/Doc/images/sty1.png" alt="">
						</div>
						<div class="layui_code">计划管理</div>
					</div>
					<div class="layui-col-md2">
						<div class="grid-demo">
						<ul>
							<li class="layui-tab-zi">
								<a href="{:U('Feedback/index')}">
								<h3 class="layui-cite">周报管理</h3>
								</a>
							</li>
							<li class="layui-tab-zi layui-tab-top">
								<a href="{:U('ProjectManagement/ProjectMinutes')}">
								<h3 class="layui-cite">会议管理</h3>
								</a>
							</li>
							<li class="layui-tab-zi layui-tab-top">
								<a href="{:U('ProjectManagement/Projectrisk')}">
								<h3 class="layui-cite">风险管理</h3>
								</a>
							</li>
							<li class="layui-tab-zi layui-tab-top">
								<a href="{:U('ProjectManagement/ProjectEvent')}">
								<h3 class="layui-cite">事件管理</h3>
								</a>
							</li>
						</ul>
						</div>
						<div class="style-agile-border">
						<img  src="/Public/Doc/images/sty1.png" alt="">
						</div>
						<div class="layui_code">执行管理</div>
					</div>
					<div class="layui-col-md2">
						<div class="grid-demo">
						<ul>
							<li class="layui-tab-zhonging">
								<a href="{:U('ProjectManagement/ProjectText')}">
								<h3 class="layui-cite">测试报告</h3>
								</a>
							</li>
						</ul>
						</div>
						<div class="style-agile-border">
						<img  src="/Public/Doc/images/sty1.png" alt="">
						</div>
						<div class="layui_code">测试联调</div>
					</div>
					<div class="layui-col-md2">
						<div class="grid-demo">
						<ul>
							<li class="layui-tab-zhonging">
								<a href="{:U('ProjectManagement/ProjectTextrun')}">
								<h3 class="layui-cite">试运行记录</h3>
								</a>
							</li>
						</ul>
						</div>
						<div class="style-agile-border">
						<img  src="/Public/Doc/images/sty1.png" alt="">
						</div>
						<div class="layui_code">试运行</div>
					</div>
					<div class="layui-col-md2">
						<div class="grid-demo">						
						<ul>
							<li class="layui-tab-zhongpp">
								<a href="{:U('ProjectManagement/ProjectAcceptance')}">
								<h3 class="layui-cite">项目验收</h3>
								</a>
							</li>
							<li class="layui-tab-zhongpp layui-tab-top">
								<a href="{:U('KnowledgeSharing/index')}">
								<h3 class="layui-cite">成员考勤</h3>
								</a>
							</li>
							<li class="layui-tab-zhongpp layui-tab-top">
								<a href="{:U('KnowledgeSharing/index')}">
								<h3 class="layui-cite">成员考核</h3>
								</a>
							</li>
						</ul>
						</div>
						<div class="layui_code">验收归档</div>
					</div>
				</div>
			</div>
			<div class="details_zhong">
				<div class="layui-row">
					<div class="layui-col-md12">
					<blockquote class="layui-elem-quote addThispro">计划信息列表</blockquote>
					<button class="addThisPeo" lay-filter="addThisPeo">新增计划</button>
					</div>
					<div class="layui-col-md12">
					<table class="layui-hide" id="peoples" lay-filter="peoples"></table>
					</div>
				</div>
			</div>
		</div>
		<!-- 新增功能弹框 -->
			<div class="layui-row" id="addPeople" style="display: none;padding: 20px 30px;">
				<div class="layui-col-md12">
						<form class="layui-form" id="addEmployeeForm">
							<div class="layui-col-md6">
								<div class="layui-form-item">
										<label class="layui-form-label">计划名称：</label>
										<div class="layui-input-block">
											<select name="conpany_add" id="conpany_add" lay-verify="required" lay-filter="see_depart">
													<option value="">请选择计划名称</option>
											</select>
										</div>
								</div>
							</div>
							<div class="layui-col-md6">
								<div class="layui-form-item">
										<label class="layui-form-label">里程碑：</label>
										<div class="layui-input-block">
												<select name="licheng_add" id="licheng_add" lay-verify="required" >
														<option value="">请选择里程碑</option>
												</select>
										</div>
								</div>
							</div>
							<div class="layui-col-md6">
								<div class="layui-form-item">
										<label class="layui-form-label">责任人：</label>
										<div class="layui-input-block">
											<select name="people_add" id="people_add" lay-verify="required" >
													<option value="">请选择责任人</option>
											</select>
										</div>
								</div>
							</div>
							<div class="layui-col-md6">
								<div class="layui-form-item">
										<label class="layui-form-label">人员姓名：</label>
										<div class="layui-input-block">
												<select name="people_add1" id="people_add1" lay-verify="required" >
														<option value="">请选择组成员</option>
												</select>
										</div>
								</div>
							</div>
							<div class="layui-col-md6">
								<div class="layui-form-item">
										<label class="layui-form-label">岗位职责：</label>
										<div class="layui-input-block">
												<select name="job_add" id="job_add" lay-verify="required" >
														<option value="">请选择岗位职责</option>
												</select>
										</div>
								</div>
							</div>
							<div class="layui-col-md6">
								<div class="layui-form-item">
										<label class="layui-form-label">计划类别：</label>
										<div class="layui-input-block">
												<select class="layui-input" name="proleibie"  lay-verify="required">
													<option value ="">请选择计划类别</option>
													<option value ="0">计划内</option>
													<option value ="1">新增</option>
													<option value ="1">变更</option>
												</select>
										</div>
								</div>
							</div>
							<div class="layui-col-md6">
								<div class="layui-form-item">
										<label class="layui-form-label">开始时间：</label>
										<div class="layui-input-block">
												<input name="conpany" id="test1" class="layui-input" lay-verify="required">
										</div>
								</div>
							</div>
							<div class="layui-col-md6">
								<div class="layui-form-item">
										<label class="layui-form-label">结束时间：</label>
										<div class="layui-input-block">
												<input  name="conpany" id="test2" class="layui-input" lay-verify="required">
										</div>
								</div>
							</div>
							<div class="layui-col-md12">
								<div class="layui-form-item">
										<label class="layui-form-label">计划内容：</label>
										<div class="layui-input-block">
												<textarea name="textject1" placeholder="" class="layui-textarea"></textarea>
										</div>
								</div>
							</div>
							<div class="layui-col-md12">
								<div class="layui-form-item">
									<label class="layui-form-label">相关备注：</label>
									<div class="layui-input-block">
										<textarea name="textject" placeholder="" class="layui-textarea"></textarea>
									</div>
								</div>	
							</div>
							<div class="layui-form-item">
								<div class="layui-input-block">
									<button class="layui-btn" lay-submit="" lay-filter="demoone">提交</button>
									<button type="reset" class="layui-btn layui-btn-primary">重置</button>
								</div>
							</div>	
						</form>
				</div>
		</div>
</body>
<script src="__DOCLAY__/plugins/layui/layui.js"></script>
<script>
	var form,layedit,layer,laydate; 
	layui.use(['form', 'layedit', 'laydate','table'], function(){
	  form = layui.form,
		layer = layui.layer,
		layedit = layui.layedit,
		laydate = layui.laydate;
	//开始运行日期 
		laydate.render({
			elem: '#test1'
			});
	//结束时间
		laydate.render({
			elem: '#test2'
			});
				//监听提交
			form.on('submit(demoone)', function(data){
				var sssplan =$("#conpany_add").find("option:selected").text(); 
				var s_time=$("#test1").val(); 
				var e_time=$("#test2").val(); 
				$.ajax({
				url:"{:U('ItemMilepost/workPlanAdd')}",
				type: 'post',
				data: {
					pro_code:12,  // 根据前面页面跳转
					plan_name:sssplan,
					plan_code:data.field.conpany_add,
					plan_id:data.field.licheng_add,
					plan_type:data.field.proleibie,  // 
					main_member:data.field.people_add,
					member_name:data.field.people_add1,
					duty:data.field.job_add,
					task_content :data.field.textject1,					
					plan_stime :s_time,
					plan_etime :e_time,
					remarks:data.field.textject,
				},
				dataType: 'json',
				success: function(res) {
						if(res.code == 200) {
							layui.use('layer', function() {	
								layer.close(layer.index);
								layer.alert('添加成功');
							})
						} else {
							layui.use('layer', function() {
								var layer = layui.layer;
								layer.alert('添加失败');
							})
						}			
				},
				})
				return false;
			});
			
			table.render({
				elem: '#peoples',
				url:"{:U('ItemMilepost/workPlanList')}",
				where:{                     //  页面传值   项目经理id
					pro_code:12
				},
				// even:true,
				height: 270,
				cellMinWidth: 110,
				cols: [[
					{field:'id',title: 'ID', sort: true},
					{field:'content', title: '试运行内容',align:'center'},
					{field:'situation', title: '试运行情况',align:'center'},
					{field:'evaluate',title: '用户评价',align:'center'},
					{field:'start_time',title: '开始时间'}, //minWidth：局部定义当前单元格的最小宽度，layui 2.2.1 新增
					{field:'stop_time', title: '结束时间',align:'center'},
					{field:'target', title: '达成目标',align:'center'},
					{field:'right',title: '操作',toolbar: '#barDemo',align:'center'}
				]],
				page: true,//开启分页
				limit:5,   //默认十条数据一页
				limits:false,  //数据分页条
			});
			
			//  根据计划内容选 里程碑id
				form.on('select(see_depart)', function(data){
					var peo_name =$("#conpany_add").val(); 
					$.ajax({
					url:"{:U('ItemMilepost/selMile')}",
					type: 'post',
					data: {
						plan_code :peo_name
					},
					dataType: 'json',
					success: function(data) {
							if (data.code == 200) {
									var result = data || [];
									var role_peo = document.getElementById("licheng_add");        //add_role_name给select定义的id  	      	      
									for (var i = 0; i<result.data.length; i++) {
											var option = document.createElement("option");    // 创建添加option属性
											option.setAttribute("value",result.data[i].milepost_id);                  // 给option的value添加值
											option.innerText= result.data[i].plan_name;             // 打印option对应的纯文本 （超级管理员、管理员）
											role_peo.appendChild(option);                          // 给select 添加option子标签
											form.render("select");                                // 刷性select，显示出数据        
											}
							}
					}    
					})				
					});
			selectProject();   //  选择项目计划内容
			selectProjectname();  // 选择责任人
			selectProjectjob();  // 选择职责
		});
		
		// 添加项目组成员
		$('.addThisPeo').on('click',function(){
				layer.open({
						type: 1,
						title: '新增风险',
						closeBtn: 2,   // 关闭样式
						shadeClose: true,  // 关闭方式
						anim:5,    // 弹出样式
						area: ['48vw', '78vh'],
						// btn:['确定','取消'],
						isOutAnim:false,    // 关闭动画
						content: $('#addPeople'),
				})
		}); 
		
		function selectProject(){
			$.ajax({
			url:"{:U('ItemMilepost/selPlan')}",
			type: 'post',
			data: {
				pro_code:233,
			},
			dataType: 'json',
			success: function(data) {
					if (data.code == 200) {
							var result = data.data || [];
							console.log(result);
							var role = document.getElementById("conpany_add");        //add_role_name给select定义的id     	      	      
							for (var i = 0; i<result.length; i++) {
									var option = document.createElement("option");    // 创建添加option属性
									option.setAttribute("value",result[i].plan_code);                  // 给option的value添加值
									option.innerText= result[i].plan_name;             // 打印option对应的纯文本 （超级管理员、管理员）
									role.appendChild(option);                          // 给select 添加option子标签
									form.render("select");                                // 刷性select，显示出数据        
									} 
					}
			}    
			})
		}			
		function selectProjectjob(){
			$.ajax({
			url:"{:U('ItemMilepost/selJob')}",
			type: 'post',
			data: {},
			dataType: 'json',
			success: function(data) {
					if (data.code == 200) {
							var result = data.data || [];
							console.log(result);
							var role = document.getElementById("job_add");        //add_role_name给select定义的id     	      	      
							for (var i = 0; i<result.data.length; i++) {
									var option = document.createElement("option");    // 创建添加option属性
									option.setAttribute("value",result.data[i].jobtype_id);                  // 给option的value添加值
									option.innerText= result.data[i].jobtype_name;             // 打印option对应的纯文本 （超级管理员、管理员）
									role.appendChild(option);                          // 给select 添加option子标签
									form.render("select");                                // 刷性select，显示出数据        
									} 
					}
			}    
			})
		}			

		function selectProjectname(){
			$.ajax({
			url:"{:U('ItemMilepost/selMember')}",
			type: 'post',
			data: {
				pro_code:233,
			},
			dataType: 'json',
			success: function(data) {
					if (data.code == 200) {
							var result = data.data || [];
							console.log(result);
							var role = document.getElementById("people_add");        //add_role_name给select定义的id     
							var role1 = document.getElementById("people_add1");        //add_role_name给select定义的id           	      
							for (var i = 0; i<result.data.length; i++) {
									var option = document.createElement("option");    // 创建添加option属性
									option.setAttribute("value",result.data[i].user_code);                  // 给option的value添加值
									option.innerText= result.data[i].member_name;             // 打印option对应的纯文本 （超级管理员、管理员）
									role.appendChild(option);                          // 给select 添加option子标签
									form.render("select");                                // 刷性select，显示出数据        
									} 
							for (var i = 0; i<result.data.length; i++) {
									var option = document.createElement("option");    // 创建添加option属性
									option.setAttribute("value",result.data[i].user_code);                  // 给option的value添加值
									option.innerText= result.data[i].member_name;             // 打印option对应的纯文本 （超级管理员、管理员）
									role1.appendChild(option);                          // 给select 添加option子标签
									form.render("select");                                // 刷性select，显示出数据        
									} 
					}
			}    
			})
		}		
</script>
</html>