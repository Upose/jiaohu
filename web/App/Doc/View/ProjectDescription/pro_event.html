<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>重大事件</title>
    <link rel="stylesheet" href="__DOCLAY__/build/css/app.css" media="all">
    <link rel="stylesheet" href="__CSS__/pro_demand.css" media="all">
    <script src="__STATIC__/jquery-2.0.3.min.js"></script>
    <script src="__STATIC__/vue.min.js"></script>
</head>

<body class="app">
    <!-- 最上层搜索栏 -->
    <div class="search_div">
        时间区间：<input class="bag_time" type="date"> 至 <input class="end_time" type="date">
        <input class="keyword" type="text" placeholder="关键词"><button @click="search(Uid)" class="search_button">搜索</button>
        <button class="new_button" @click="new_pro(Uid)">新增</button>
    </div>
    <table>
        <tr class="tr1">
            <td>名称</td>
            <td>类型</td>
            <td>提交人</td>
            <td>开始时间</td>
            <td>结束时间</td>
            <td>操作</td>
        </tr>
        <tr class="tr2">
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td><a @click="view()">详情</a></td>
        </tr>
    </table>
</body>
<script>
    var app = new Vue({
        el: ".app",
        data: {
            data: [],
            Uid: "",
        },
        created: function () {
            this.Uid = "{$pro_id}";
            this.getdata(this.Uid);
            // console.log(this.Uid);
        },
        methods: {
            new_pro(id) {
                // window.location.href = "{:U('ProjectDescription/new_event')}" + "&id=" + id;
                window.location.href = "{:U('ProjectDescription/new_event')}";
            },
            view(id) {
                // window.location.href = "{:U('ProjectDescription/new_demand')}"+"&id="+ id;
                window.location.href = "{:U('ProjectDescription/event_view')}";
            },
            design(id) {
                // window.location.href = "{:U('ProjectDescription/new_demand')}"+"&id="+ id;
                window.location.href = "{:U('ProjectDescription/demand_design')}";
            },
            getdata(id) {
                var that = this;
                $.ajax({
                    cache: false,
                    type: "post",
                    url: "{:U('ProjectNeed/needlist')}",
                    dataType: "json",
                    data: { pid: id },
                    success: function (data) {
                        that.data = data.data;
                    }
                })
            },
            search(id) {
                var that = this;
                var start_time = $(".bag_time").val();
                var end_time = $(".end_time").val();
                var keyword = $(".keyword").val();
                $.ajax({
                    cache: false,
                    type: "post",
                    url: "{:U('ProjectNeed/needlist')}",
                    dataType: "json",
                    data: { pid: id, start_time: start_time, end_time: end_time, title: keyword },
                    success: function (data) {
                        that.data = data.data;
                    }
                })
            },
        },
    })
</script>

</html>