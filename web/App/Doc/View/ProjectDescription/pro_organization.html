<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>需求管理</title>
    <link rel="stylesheet" href="__DOCLAY__/build/css/app.css" media="all">
    <link rel="stylesheet" href="__CSS__/pro_organization.css" media="all">
    <script src="__STATIC__/jquery-2.0.3.min.js"></script>
    <script src="__STATIC__/vue.min.js"></script>
</head>

<body class="app">
    <!-- 上方按钮选择 -->
    <div class="search_div">
        <button @click="getdata(Uid)" class="current sty">当前人员</button>
        <button @click="history(Uid)" class="history">历史人员</button>
        <button @click="" class="new_button">新增</button>
    </div>
    <div class="con_left">
        <div class="safety">
            <!-- 标题 -->
            <div class="tit"><span class="pro_name">内部干系人</span> <span class="more safety_span">展开更多&ensp;<img src="__IMG__/icon_unfold.png"></span></div>
            <div class="safety_pro collapse">
                <div v-for="i in data.inMember" class="pro_div">
                    <p>
                        <img class="avatar" src="__IMG__/b.jpg">
                        <span class="name">{{i.name}}</span>
                        <span class="time">({{i.position}})</span>
                        <!-- <span class="department">{{i.department}}</span> -->
                    </p>
                    <p class="personnel">
                        <img src="__IMG__/phone_icon.png" alt="">{{i.phone}}</p>
                    <p class="time">{{i.start_time}} 至 {{i.end_time}}</p>
                    <div class="button_div">
                        <button><span @click="open(i.id)">离场</span></button>
                    </div>
                </div>
            </div>
            <!-- 标题 -->
            <div class="tit"><span class="pro_name">外部干系人</span> <span class="more safety_span">展开更多&ensp;<img src="__IMG__/icon_unfold.png"></span></div>
            <div class="safety_pro collapse">
                <div v-for="i in data.outMember" class="pro_div">
                    <p>
                        <img class="avatar" src="__IMG__/b.jpg">
                        <span class="name">{{i.name}}</span>
                        <span class="time">({{i.position}})</span>
                        <span class="department">{{i.department}}</span>
                    </p>
                    <p class="personnel">
                        <img src="__IMG__/phone_icon.png" alt="">{{i.phone}}</p>
                    <p class="time">{{i.start_time}} 至 {{i.end_time}}</p>
                    <div class="button_div">
                        <button><span @click="open(i.id)">离场</span></button>
                    </div>
                </div>
            </div>
            <!-- 标题 -->
            <div class="tit"><span class="pro_name">开发团队</span> <span class="more safety_span">展开更多&ensp;<img src="__IMG__/icon_unfold.png"></span></div>
            <div class="safety_pro collapse">
                <div v-for="i in data.developers" class="pro_div">
                    <p>
                        <img class="avatar" src="__IMG__/b.jpg">
                        <span class="name">{{i.name}}</span>
                        <span class="time">({{i.position}})</span>
                        <span class="department">{{i.department}}</span>
                    </p>
                    <p class="personnel">
                        <img src="__IMG__/phone_icon.png" alt="">{{i.phone}}</p>
                    <p class="time">{{i.start_time}} 至 {{i.end_time}}</p>
                    <div class="button_div">
                        <button><span @click="open(i.id)">离场</span></button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="con_right">
        <input class="keyword" type="text" placeholder="请输入要检索的内容"><button @click="search(Uid)" class="search_button">搜索</button>
        <div v-for="i in list" class="one">
            <span></span>
            <p>{{i.time}}</p>
            <p><span>{{i.name}}</span><span style="float: right;">{{i.state}}</span></p>
        </div>
    </div>
    <div class="new_member">
        <div class="member_tit">新增成员</div>
        <div class="member_con">
            <p><span>类&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;型：</span>
                <input class="top1 in_input" type="radio" name="member" id="" checked>内部&nbsp;&nbsp;&nbsp;&nbsp;
                <input class="top1 out_input" type="radio" name="member" id="">外部
            </p>
            <div class="member_in">
                <p><span>员&nbsp;&ensp;工&nbsp;ID：</span><input class="member_text" type="text"></p>
                <p><span>标&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;签：</span>
                    <input class="top1" type="radio" name="member" id="">内部关系人&nbsp;&nbsp;&nbsp;&nbsp;
                    <input class="top1" type="radio" name="member" id="">开发团队
                </p>
            </div>
            <div class="member_out" style="display:none;">
                <p><span>姓&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名：</span><input class="member_text" type="text" name="" id=""></p>
                <p><span>联系方式：</span><input class="member_text" type="text" name="" id=""></p>
                <p><span>职&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;位：</span>
                    <select class="member_text"  name="" id="">
                        <option value="">项目经理</option>
                    </select>
                </p>
                <p><span>标&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;签：</span>
                    <input class="top1" type="radio" name="member" id="">外部关系人&nbsp;&nbsp;&nbsp;&nbsp;
                    <input class="top1" type="radio" name="member" id="">开发团队
                </p>
                <p><span>公&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;司：</span><input class="member_text" type="text" name="" id=""></p>
            </div>
        </div>
        <div class="btn_div">
            <button class="down_btn">取消</button>
            <button>确定</button>
        </div>
    </div>
</body>
<script>
    var app = new Vue({
        el: ".app",
        data: {
            data: [],
            Uid: "",
            list: [],
        },
        created: function () {
            this.Uid = "{$pro_id}";
            this.getdata(this.Uid);
            this.historylist(this.Uid);
        },
        methods: {
            getdata(id) {
                var that = this;
                $.ajax({
                    cache: false,
                    type: "post",
                    url: "{:U('ProjectOrganization/currentMemberList')}",
                    dataType: "json",
                    data: { project_id: id },
                    success: function (data) {
                        that.data = data.data;
                        // console.log(data.data);
                    }
                })
            },
            history(id) {
                var that = this;
                $.ajax({
                    cache: false,
                    type: "post",
                    url: "{:U('ProjectOrganization/historyMemberList')}",
                    dataType: "json",
                    data: { project_id: id },
                    success: function (data) {
                        that.data = data.data;
                        // console.log(data.data);
                    }
                })
            },
            historylist(id) {
                var that = this;
                $.ajax({
                    cache: false,
                    type: "post",
                    url: "{:U('ProjectOrganization/history')}",
                    dataType: "json",
                    data: { project_id: id },
                    success: function (data) {
                        that.list = data.data;
                        // console.log(data.data);
                    }
                })
            },
            search(id){
                var that = this;
                var key = $(".keyword").val();
                $.ajax({
                    cache: false,
                    type: "post",
                    url: "{:U('ProjectOrganization/history')}",
                    dataType: "json",
                    data: { project_id: id,name:key},
                    success: function (data) {
                        that.list = data.data;
                        // console.log(data.data);
                    }
                })
            }
        }
    })

    var num = 1;
    $(document).on("click", ".safety_span", function () {
        // console.log("111");
        if (num % 2 == 0) {
            $(this).html('展开更多&ensp;<img src="__IMG__/icon_unfold.png">');
            $(this).parent().next().toggleClass('collapse');
            // console.log($(this).parent().next().attr("class"));
            num = num + 1;
            return num;
        } else {
            $(this).html('收起更多&ensp;<img src="__IMG__/icon_retract.png">');
            $(this).parent().next().toggleClass('collapse');
            num = num + 1;
            return num;
        }
    });
    $(".new_button").on('click', function () {
        $(".new_member").show();
    });
    $(".down_btn").on('click', function () {
        $(".new_member").hide();
    });
    $(".current").on("click", function () {
        $(".current").addClass("sty").siblings().toggleClass("sty");
    })
    $(".history").on("click", function () {
        $(".history").addClass("sty").siblings().toggleClass("sty");
    })
    $(".in_input").on("click",function(){
        $(".member_in").show();
        $(".member_out").hide();
    })
    $(".out_input").on("click",function(){
        $(".member_in").hide();
        $(".member_out").show();
    })
</script>